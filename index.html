<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>COTIZADOR CORPORATIVO</title>

    <!-- Tipografía -->
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600&display=swap" rel="stylesheet">

    <!-- SheetJS -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --primario: #3D57C7;
            --secundario: #005E5C;
            --acento: #D0D8E8;
            --fondo: #F9F9FF;
        }

        body {
            font-family: 'Sora', sans-serif;
            background: var(--fondo);
            margin: 20px;
            display: flex;
            gap: 40px;
            color: var(--secundario);
        }

        h2 {
            color: var(--primario);
            margin-bottom: 10px;
        }

        .left, .right {
            width: 50%;
        }

        input[type="file"], select {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border-radius: 6px;
            border: 1px solid var(--secundario);
            font-family: 'Sora', sans-serif;
        }

        button {
            margin-top: 10px;
            padding: 8px;
            width: 100%;
            background: var(--primario);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: var(--secundario);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th {
            background: var(--acento);
            padding: 10px;
            text-align: left;
        }

        td {
            padding: 8px;
            border: 1px solid #ccc;
        }

        .summary {
            background: var(--acento);
            padding: 15px;
            border-radius: 8px;
        }

        .summary p {
            margin: 6px 0;
        }
    </style>
</head>
<body>

<div class="left">
    <h2>Carga de archivo Excel</h2>
    <input type="file" id="fileInput" accept=".xlsx">
    <button onclick="cargarXLSX()">Cargar XLSX</button>

    <h2>Detalle de titulares</h2>
    <table>
        <thead>
            <tr>
                <th>CUIL</th>
                <th>Apellido y Nombre</th>
                <th>Remuneración</th>
                <th>Aporte (8%)</th>
                <th>Adherentes</th>
            </tr>
        </thead>
        <tbody id="tablaBody"></tbody>
    </table>
</div>

<div class="right">
    <h2>Cotización</h2>

    <label><strong>Plan seleccionado</strong></label>
    <select id="planGlobal" onchange="actualizarResumen()">
        <option value="D2100">D2100 – $63.859</option>
        <option value="D3100">D3100 – $73.148</option>
        <option value="D4100">D4100 – $84.062</option>
    </select>

    <div class="summary" style="margin-top:15px">
        <p>Titulares: <strong id="totalTitulares">0</strong></p>
        <p>Adherentes: <strong id="totalAdherentes">0</strong></p>
        <p>Total de cápitas: <strong id="totalCapitas">0</strong></p>
        <p>Total de aportes: <strong>$<span id="totalAportes">0.00</span></strong></p>
        <hr>
        <p><strong>Costo bruto total:</strong></p>
        <p style="font-size:18px">$<strong id="costoBruto">0.00</strong></p>
    </div>
</div>

<script>
    let titulares = [];

    const preciosPlanes = {
        D2100: 63859,
        D3100: 73148,
        D4100: 84062
    };

    function cargarXLSX() {
        const file = document.getElementById("fileInput").files[0];
        if (!file) {
            alert("Seleccione un archivo XLSX.");
            return;
        }

        const reader = new FileReader();
        reader.onload = e => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            procesarDatos(json);
        };
        reader.readAsArrayBuffer(file);
    }

    function procesarDatos(data) {
        titulares = [];

        data.forEach(row => {
            if (!row["CUIL"]) return;

            const remuneracion = Number(row["Remuneración"]);
            const adherentes =
                Number(
                    row["Cantidad de Adherentes"] ??
                    row["Adherentes"] ??
                    row["Cantidad adherentes"] ??
                    row["Cant. Adherentes"] ??
                    0
                );

            titulares.push({
                cuil: row["CUIL"],
                nombre: row["Apellido y Nombre"],
                remuneracion,
                aporte: remuneracion * 0.08,
                adherentes
            });
        });

        renderTabla();
        actualizarResumen();
    }

    function renderTabla() {
        const tbody = document.getElementById("tablaBody");
        tbody.innerHTML = "";

        titulares.forEach(t => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${t.cuil}</td>
                <td>${t.nombre}</td>
                <td>${t.remuneracion.toFixed(2)}</td>
                <td>${t.aporte.toFixed(2)}</td>
                <td>${t.adherentes}</td>
            `;
            tbody.appendChild(tr);
        });
    }

    function actualizarResumen() {
        const totalTitulares = titulares.length;
        const totalAdherentes = titulares.reduce((s, t) => s + t.adherentes, 0);
        const totalCapitas = totalTitulares + totalAdherentes;
        const totalAportes = titulares.reduce((s, t) => s + t.aporte, 0);

        const plan = document.getElementById("planGlobal").value;
        const costoBruto = preciosPlanes[plan] * totalCapitas;

        document.getElementById("totalTitulares").textContent = totalTitulares;
        document.getElementById("totalAdherentes").textContent = totalAdherentes;
        document.getElementById("totalCapitas").textContent = totalCapitas;
        document.getElementById("totalAportes").textContent = totalAportes.toFixed(2);
        document.getElementById("costoBruto").textContent = costoBruto.toFixed(2);
    }
</script>

</body>
</html>
